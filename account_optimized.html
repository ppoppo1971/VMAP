<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ê³„ë¶€</title>
    
    <!-- CSS íŒŒì¼ë“¤ -->
    <link rel="stylesheet" href="css/account.css">
    
    <!-- JavaScript íŒŒì¼ë“¤ -->
    <script src="js/utils.js"></script>
    <script src="js/account.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>í™‹ì¹´ì´ë„ ì—¬í–‰ ê°€ê³„ë¶€</h1>
            <p>ì—¬í–‰ ê²½ë¹„ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ê´€ë¦¬í•˜ì„¸ìš”</p>
        </div>
        
        <div class="table-container">
            <div class="controls">
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterData('all')">ì „ì²´</button>
                    <button class="filter-btn" onclick="filterData('transportation')">êµí†µ</button>
                    <button class="filter-btn" onclick="filterData('accommodation')">ìˆ™ë°•</button>
                    <button class="filter-btn" onclick="filterData('food')">ì‹ì‚¬</button>
                    <button class="filter-btn" onclick="filterData('shopping')">ì‡¼í•‘</button>
                    <button class="filter-btn" onclick="filterData('activity')">í™œë™</button>
                    <button class="filter-btn" onclick="filterData('other')">ê¸°íƒ€</button>
                </div>
                <button class="export-btn" onclick="exportToCSV()">CSV ë‚´ë³´ë‚´ê¸°</button>
            </div>
            
            <table class="budget-table" id="budgetTable">
                <thead>
                    <tr>
                        <th>ë‚ ì§œ</th>
                        <th>í•­ëª©</th>
                        <th>ë‚´ìš©</th>
                        <th>ê²°ì œë°©ë²•</th>
                        <th>ê¸ˆì•¡</th>
                        <th>ì‚­ì œ</th>
                    </tr>
                </thead>
                <tbody id="budgetTableBody">
                    <!-- ë°ì´í„°ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </tbody>
            </table>
            
            <div id="noData" class="no-data" style="display: none;">
                <p>ë“±ë¡ëœ ì§€ì¶œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        </div>
    </div>
    
    <!-- ì¶”ê°€/í¸ì§‘ í¼ ëª¨ë‹¬ -->
    <div id="expenseModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">ì§€ì¶œ ì¶”ê°€</h3>
                <button class="close-btn" onclick="closeExpenseModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="expenseForm">
                    <div class="form-group">
                        <label for="expenseDate">ë‚ ì§œ</label>
                        <input type="date" id="expenseDate" required>
                    </div>
                    <div class="form-group">
                        <label for="expenseCategory">í•­ëª©</label>
                        <select id="expenseCategory" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="transportation">êµí†µ</option>
                            <option value="accommodation">ìˆ™ë°•</option>
                            <option value="food">ì‹ì‚¬</option>
                            <option value="shopping">ì‡¼í•‘</option>
                            <option value="activity">í™œë™</option>
                            <option value="other">ê¸°íƒ€</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="expenseDescription">ë‚´ìš©</label>
                        <input type="text" id="expenseDescription" placeholder="ì§€ì¶œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                    </div>
                    <div class="form-group">
                        <label for="expensePayment">ê²°ì œë°©ë²•</label>
                        <select id="expensePayment" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="card">ì¹´ë“œ</option>
                            <option value="cash">í˜„ê¸ˆ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="expenseAmount">ê¸ˆì•¡</label>
                        <input type="number" id="expenseAmount" placeholder="ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                    </div>
                    <div class="form-group">
                        <label for="expenseCurrency">í†µí™”</label>
                        <select id="expenseCurrency" required>
                            <option value="KRW">ì› (KRW)</option>
                            <option value="JPY">ì—” (JPY)</option>
                        </select>
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="save-btn">ì €ì¥</button>
                        <button type="button" class="cancel-btn" onclick="closeExpenseModal()">ì·¨ì†Œ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- ì¶”ê°€ ë²„íŠ¼ -->
    <button id="addExpenseBtn" class="floating-btn" onclick="openExpenseModal()">+</button>
    
    <!-- í†µê³„ ëª¨ë‹¬ -->
    <div id="statsModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ì§€ì¶œ í†µê³„</h3>
                <button class="close-btn" onclick="closeStatsModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="stats-grid" id="statsGrid">
                    <!-- í†µê³„ ë°ì´í„°ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- í†µê³„ ë²„íŠ¼ -->
    <button id="statsBtn" class="floating-btn stats-btn" onclick="openStatsModal()">ğŸ“Š</button>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, connectFirestoreEmulator } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth, connectAuthEmulator } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getStorage, connectStorageEmulator } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyDVwJrvIcbqAOX24g9JODhD7DGtTz7z2Pg",
            authDomain: "hokkaido-travel-plan.firebaseapp.com",
            projectId: "hokkaido-travel-plan",
            storageBucket: "hokkaido-travel-plan.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdef1234567890abcdef"
        };
        
        // Firebase ì´ˆê¸°í™”
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const storage = getStorage(app);
        
        // ê°œë°œ í™˜ê²½ì—ì„œ ì—ë®¬ë ˆì´í„° ì—°ê²°
        if (window.location.hostname === 'localhost') {
            try {
                connectFirestoreEmulator(db, 'localhost', 8080);
                connectAuthEmulator(auth, 'http://localhost:9099');
                connectStorageEmulator(storage, 'localhost', 9199);
            } catch (error) {
                console.log('ì—ë®¬ë ˆì´í„° ì—°ê²° ì‹¤íŒ¨:', error);
            }
        }
        
        // ì „ì—­ìœ¼ë¡œ Firebase ê°ì²´ ë‚´ë³´ë‚´ê¸°
        window.firebase = { app, db, auth, storage };
        
        // Firebase ì¤€ë¹„ ì™„ë£Œ ì´ë²¤íŠ¸ ë°œìƒ
        window.dispatchEvent(new CustomEvent('firebaseReady'));
    </script>
    
    <!-- ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ê°€ê³„ë¶€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            
            // ê°€ê³„ë¶€ ì´ˆê¸°í™”
            if (typeof initAccount === 'function') {
                initAccount();
            }
            
            // ë°ì´í„° ë¡œë“œ
            if (typeof loadBudgetData === 'function') {
                loadBudgetData();
            }
        });
        
        // Firebase ì¤€ë¹„ ì™„ë£Œ ëŒ€ê¸°
        window.addEventListener('firebaseReady', function() {
            console.log('Firebase ì¤€ë¹„ ì™„ë£Œ');
            
            // Firebase ê´€ë ¨ ì´ˆê¸°í™” ì‘ì—…
            if (typeof initFirebase === 'function') {
                initFirebase();
            }
        });
        
        // ì—ëŸ¬ í•¸ë“¤ë§
        window.addEventListener('error', function(event) {
            console.error('ì „ì—­ ì—ëŸ¬:', event.error);
            if (typeof handleError === 'function') {
                handleError(event.error, 'ì „ì—­ ì—ëŸ¬');
            }
        });
        
        // Promise rejection í•¸ë“¤ë§
        window.addEventListener('unhandledrejection', function(event) {
            console.error('ì²˜ë¦¬ë˜ì§€ ì•Šì€ Promise rejection:', event.reason);
            if (typeof handleError === 'function') {
                handleError(event.reason, 'Promise rejection');
            }
        });
        
        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
        window.addEventListener('beforeunload', function() {
            if (typeof cleanupOnUnload === 'function') {
                cleanupOnUnload();
            }
        });
    </script>
</body>
</html>
