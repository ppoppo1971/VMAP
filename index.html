<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>홋카이도 여행</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100vw;
            height: 100vh;
            min-height: 100%;
        }
        h1 {
            display: none;
        }

        /* 사이드바 스타일 */
        #customMapMenu {
            position: absolute;
            top: 40px;
            left: 30px;
            z-index: 10;
            width: 220px;
            background: rgba(255,255,255,0.86);
            border: 1px solid rgba(255,255,255,0.35);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.18);
            padding: 12px 9px 9px 9px;
            display: flex;
            flex-direction: column;
            gap: 9px;
            font-family: 'Noto Sans KR', sans-serif;
            backdrop-filter: blur(6px) saturate(110%);
            -webkit-backdrop-filter: blur(6px) saturate(110%);
            transition: box-shadow 0.2s, left 0.3s, opacity 0.3s, background-color 0.2s;
        }
        #customMapMenu.hide {
            left: -260px;
            opacity: 0;
            pointer-events: none;
        }
        #customMapMenu h2 {
            font-size: 1.2rem;
            font-weight: 700;
            margin: 0 0 12px 0;
            color: #222;
        }
        .menu-group {
            margin-bottom: 5px;
        }
        .menu-group label {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 6px;
            display: block;
            color: #555;
        }
        /* 공통 버튼 스타일 */
        .menu-group button, .toggle-btn {
            width: 100%;
            background: #f7f7f7;
            border: none;
            border-radius: 8px;
            padding: 5px 0;
            margin-bottom: 3px;
            font-size: 1rem;
            color: #333;
            cursor: pointer;
            transition: background 0.15s, color 0.15s;
        }
        .menu-group button:hover, .toggle-btn:hover {
            background: #e0e7ff;
            color: #1d4ed8;
        }
        .menu-group .submenu {
            margin-left: 12px;
            margin-top: 4px;
        }
        /* 사이드 패널 토글 버튼 */
        #menuToggleBtn {
            position: absolute;
            top: 50px;
            left: 18px;
            z-index: 20;
            background: #1d4ed8;
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.3rem;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            display: none;
            align-items: center;
            justify-content: center;
        }
        #menuToggleBtn.show {
            display: flex;
        }
        .toggle-btn {
            text-align: left;
            font-weight: 600;
        }
        /* 하위 옵션 들여쓰기 */
        .submenu {
            margin-left: 20px;
        }
        .submenu .submenu {
            margin-left: 20px;
        }
        .submenu button {
            width: 90%;
            margin-left: 0;
        }
        /* 구글맵 하위 옵션 들여쓰기 */
        #googleMapMenu > .toggle-btn {
            margin-left: 20px;
        }
    </style>
</head>
<body>
    <h1>홋카이도 여행</h1>
    <!-- 지도를 표시할 div 요소 -->
    <div id="map"></div>
    <!-- 사이드 패널 토글 버튼 (패널이 숨겨졌을 때만 보임) -->
    <button id="menuToggleBtn" class="show" onclick="showMenu()" title="메뉴 열기">☰</button>
    <!-- 왼쪽 고정형 사이드바 메뉴 -->
    <div id="customMapMenu" class="hide">
      <h2>홋카이도 여행</h2>
      <div class="menu-group">
        <button id="googleMapToggleBtn" class="toggle-btn" onclick="toggleGoogleMapMenu()">+구글맵</button>
        <div id="googleMapMenu" style="display:none; margin-top:8px; margin-left:20px;">
          <button id="roadmapToggleBtn" class="toggle-btn" style="margin-left:0;" onclick="toggleRoadmapMenuAndSetRoadmap()">+일반</button>
          <div id="roadmapMenu" class="submenu" style="display:none;">
            <!-- 지형맵 옵션 제거됨 -->
          </div>
          <button id="satelliteToggleBtn" class="toggle-btn" style="margin-left:0;" onclick="toggleSatelliteMenuAndSetSatellite()">+위성</button>
          <div id="satelliteMenu" class="submenu" style="display:none;">
            <button onclick="setMapType('hybrid')">하이브리드</button>
          </div>
        </div>
      </div>
    </div>
    <script>
      // 전역 변수들
      let map;
      
      // DOM 캐시
      let cachedElements = {};
      function getElement(id) {
        if (!cachedElements[id]) {
          cachedElements[id] = document.getElementById(id);
        }
        return cachedElements[id];
      }
      
      // 구글맵 초기화 함수
      function initMap() {
        // 서울 시청의 위도, 경도 좌표를 중심으로 설정
        var center = { lat: 37.5665, lng: 126.9780 }; // 서울 시청 좌표
        // 구글 맵 객체 생성 및 옵션 설정
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 12, // 초기 확대 레벨
          center: center, // 지도 중심 좌표
          mapTypeControl: false, // 기본 가로 지도 타입 메뉴 비활성화
          mapTypeControlOptions: {
            // 지도 타입 선택 컨트롤에 표시할 지도 타입 목록
            mapTypeIds: ['roadmap', 'satellite', 'hybrid'],
            style: google.maps.MapTypeControlStyle.VERTICAL_BAR, // 세로 메뉴
            position: google.maps.ControlPosition.LEFT_TOP // 원하는 위치
          },
          // 기본 컨트롤들 비활성화
          fullscreenControl: false, // 전체보기 아이콘 제거
          streetViewControl: false, // 스트리트뷰 아이콘 제거
          zoomControl: false, // 줌 컨트롤 제거
          scaleControl: false, // 축척 제거
          rotateControl: false, // 회전 컨트롤 제거
          tilt: 0, // 기울기 고정
          // 3D 뷰 컨트롤 완전 제거
          gestureHandling: 'cooperative', // 제스처 처리 방식 설정
          disableDefaultUI: true, // 모든 기본 UI 요소 비활성화
          // 필요한 컨트롤만 개별적으로 활성화
          mapTypeControl: true // 지도 타입 컨트롤만 유지
        });
        
        // 지도 클릭 시 사이드패널 토글 기능 추가
        map.addListener('click', function() {
          if (!getElement('customMapMenu').classList.contains('hide')) {
            hideMenu();
          }
        });
      }
      
      function setMapType(type) {
        // 지도 타입 설정
        if (map && map.setMapTypeId) {
          map.setMapTypeId(type);
        }
      }
      
      // 최적화된 메뉴 토글 함수
      function toggleMenu(menuId, btnId, menuName, subMenus = []) {
        const menu = getElement(menuId);
        const btn = getElement(btnId);
        const isHidden = menu.style.display === 'none';
        
        menu.style.display = isHidden ? 'block' : 'none';
        btn.textContent = isHidden ? `-${menuName}` : `+${menuName}`;
        
        if (!isHidden && subMenus.length) {
          subMenus.forEach(({menuId, btnId, btnText}) => {
            getElement(menuId).style.display = 'none';
            getElement(btnId).textContent = btnText;
          });
        }
      }
      
      // 구글맵 메뉴 토글
      function toggleGoogleMapMenu() {
        toggleMenu('googleMapMenu', 'googleMapToggleBtn', '구글맵', [
          {menuId: 'roadmapMenu', btnId: 'roadmapToggleBtn', btnText: '+일반'},
          {menuId: 'satelliteMenu', btnId: 'satelliteToggleBtn', btnText: '+위성'}
        ]);
      }
      
      // +일반 클릭 시 바로 일반지도를 로드하고, 하위 메뉴만 토글
      function toggleRoadmapMenuAndSetRoadmap() {
        const menu = document.getElementById('roadmapMenu');
        const btn = document.getElementById('roadmapToggleBtn');
        if(menu.style.display === 'none') {
          setMapType('roadmap');
          menu.style.display = 'block';
          btn.textContent = '-일반';
        } else {
          menu.style.display = 'none';
          btn.textContent = '+일반';
        }
      }
      
      // +위성 클릭 시 바로 위성지도를 로드하고, 하위에 하이브리드만 보이도록
      function toggleSatelliteMenuAndSetSatellite() {
        const menu = document.getElementById('satelliteMenu');
        const btn = document.getElementById('satelliteToggleBtn');
        if(menu.style.display === 'none') {
          setMapType('satellite');
          menu.style.display = 'block';
          btn.textContent = '-위성';
        } else {
          menu.style.display = 'none';
          btn.textContent = '+위성';
        }
      }
      
      // 사이드 패널 토글 함수
      function hideMenu() {
        getElement('customMapMenu').classList.add('hide');
        getElement('menuToggleBtn').classList.add('show');
      }
      
      function showMenu() {
        getElement('customMapMenu').classList.remove('hide');
        getElement('menuToggleBtn').classList.remove('show');
      }
    </script>
    <!-- 구글 맵 API 스크립트. API 키와 콜백 함수(initMap) 지정 -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDVwJrvIcbqAOX24g9JODhD7DGtTz7z2Pg&callback=initMap" async defer></script>
</body>
</html>
