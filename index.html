<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¸Œì´ì›”ë“œ ì§€ë„ (OpenLayers ë²„ì „)</title>
    
    <!-- OpenLayers CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@8.2.0/ol.css" type="text/css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
            background-color: #f5f5f5;
        }

        .header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .controls h3 {
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .control-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-item label {
            font-weight: bold;
            color: #34495e;
            font-size: 14px;
        }

        select, button, input {
            padding: 10px 15px;
            border: 2px solid #bdc3c7;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        select:focus, input:focus {
            border-color: #3498db;
            outline: none;
        }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #2980b9;
        }

        .map-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        #map {
            width: 100%;
            height: 600px;
            border: none;
        }

        .info-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .info-panel h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .coordinate-display {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }

        .coordinate-display p {
            margin: 5px 0;
            font-family: monospace;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 10px;
            }
            
            .control-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            #map {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ—ºï¸ ë¸Œì´ì›”ë“œ ì§€ë„ ì›¹í˜ì´ì§€ (OpenLayers)</h1>
        <p>OpenLayersë¥¼ ì´ìš©í•œ ë¸Œì´ì›”ë“œ ì§€ë„ ì„œë¹„ìŠ¤</p>
    </div>

    <div class="container">
        <div class="controls">
            <h3>ì§€ë„ ì„¤ì •</h3>
            <div class="control-group">
                <div class="control-item">
                    <label for="mapType">ì§€ë„ ì¢…ë¥˜</label>
                    <select id="mapType">
                        <option value="Base">ê¸°ë³¸ì§€ë„</option>
                        <option value="Satellite">ìœ„ì„±ì§€ë„</option>
                        <option value="Hybrid">í•˜ì´ë¸Œë¦¬ë“œ</option>
                        <option value="Gray">íšŒìƒ‰ì§€ë„</option>
                    </select>
                </div>
                
                <div class="control-item">
                    <label for="overlayType">ì§€ì ì •ë³´ ë ˆì´ì–´</label>
                    <select id="overlayType">
                        <option value="">ì„ íƒì•ˆí•¨</option>
                        <option value="cadastral">ì—°ì†ì§€ì ë„</option>
                        <option value="controlpoint">ì§€ì ë„ê·¼ì </option>
                        <option value="both">ëª¨ë‘ í‘œì‹œ</option>
                    </select>
                </div>
                
                <div class="control-item">
                    <label for="searchLocation">ìœ„ì¹˜ ê²€ìƒ‰</label>
                    <input type="text" id="searchLocation" placeholder="ì˜ˆ: ì„œìš¸ì‹œì²­" />
                </div>
                
                <button onclick="searchAndMove()">ìœ„ì¹˜ ì´ë™</button>
                <button onclick="getCurrentLocation()">í˜„ì¬ ìœ„ì¹˜</button>
                <button onclick="resetView()">ì´ˆê¸° í™”ë©´</button>
            </div>
        </div>

        <div class="map-container">
            <div id="map"></div>
        </div>

        <div class="info-panel">
            <h3>ì§€ë„ ì •ë³´</h3>
            <div class="coordinate-display">
                <p><strong>í˜„ì¬ ì¤‘ì‹¬ì :</strong></p>
                <p>ìœ„ë„: <span id="currentLat">37.5665</span></p>
                <p>ê²½ë„: <span id="currentLng">126.9780</span></p>
                <p>ì¤Œ ë ˆë²¨: <span id="currentZoom">10</span></p>
                <p><strong>í™œì„± ë ˆì´ì–´:</strong> <span id="activeLayer">ê¸°ë³¸ì§€ë„</span></p>
            </div>
            
            <div style="margin-top: 15px; padding: 10px; background: #e8f4fd; border-radius: 5px; font-size: 12px;">
                <h4 style="margin-bottom: 8px; color: #2c3e50;">ğŸ’¡ ì‚¬ìš© íŒ</h4>
                <p>â€¢ ì§€ì ë„ê·¼ì /ì—°ì†ì§€ì ë„ë¥¼ ì„ íƒí•˜ë©´ í•´ë‹¹ ë ˆì´ì–´ê°€ í‘œì‹œë©ë‹ˆë‹¤</p>
                <p>â€¢ ì§€ì ì •ë³´ë¥¼ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                <p>â€¢ ì¤Œ ë ˆë²¨ì´ ë†’ì„ìˆ˜ë¡ ë” ë§ì€ ì •ë³´ê°€ ë¡œë“œë©ë‹ˆë‹¤</p>
            </div>
        </div>
    </div>

    <!-- OpenLayers JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/ol@8.2.0/dist/ol.js"></script>
    
    <script>
        let map;
        let vectorSource;
        let vectorLayer;
        let cadastralLayer;
        let controlPointLayer;
        let wfsLayers = {};
        
        // VWorld ì§€ë„ ë ˆì´ì–´ë“¤
        const vworldLayers = {
            Base: new ol.layer.Tile({
                source: new ol.source.XYZ({
                    url: 'https://api.vworld.kr/req/wmts/1.0.0/46F4304E-84DC-3F56-92F1-6A98A0370A31/Base/{z}/{y}/{x}.png'
                })
            }),
            Satellite: new ol.layer.Tile({
                source: new ol.source.XYZ({
                    url: 'https://api.vworld.kr/req/wmts/1.0.0/46F4304E-84DC-3F56-92F1-6A98A0370A31/Satellite/{z}/{y}/{x}.jpeg'
                })
            }),
            Hybrid: new ol.layer.Group({
                layers: [
                    new ol.layer.Tile({
                        source: new ol.source.XYZ({
                            url: 'https://api.vworld.kr/req/wmts/1.0.0/46F4304E-84DC-3F56-92F1-6A98A0370A31/Satellite/{z}/{y}/{x}.jpeg'
                        })
                    }),
                    new ol.layer.Tile({
                        source: new ol.source.XYZ({
                            url: 'https://api.vworld.kr/req/wmts/1.0.0/46F4304E-84DC-3F56-92F1-6A98A0370A31/Hybrid/{z}/{y}/{x}.png'
                        })
                    })
                ]
            }),
            Gray: new ol.layer.Tile({
                source: new ol.source.XYZ({
                    url: 'https://api.vworld.kr/req/wmts/1.0.0/46F4304E-84DC-3F56-92F1-6A98A0370A31/gray/{z}/{y}/{x}.png'
                })
            })
        };

        // WFS ë ˆì´ì–´ ìƒì„± í•¨ìˆ˜
        function createWFSLayer(layerName, typeName, styleConfig) {
            const vectorSource = new ol.source.Vector({
                format: new ol.format.GeoJSON(),
                url: function(extent) {
                    const bbox = ol.proj.transformExtent(extent, 'EPSG:3857', 'EPSG:4326');
                    
                    // í˜„ì¬ ë„ë©”ì¸ ìë™ ê°ì§€ (ë“±ë¡ëœ ë„ë©”ì¸ ì‚¬ìš©)
                    let domain = window.location.origin;
                    
                    // GitHub Pages ë„ë©”ì¸ìœ¼ë¡œ ì„¤ì • (ë¸Œì´ì›”ë“œì— ë“±ë¡ëœ ë„ë©”ì¸)
                    if (domain.includes('localhost') || domain.includes('127.0.0.1') || domain.includes('file:')) {
                        domain = 'https://ppoppo1971.github.io';
                    }
                    
                    console.log('ì‚¬ìš©í•  ë„ë©”ì¸:', domain);
                    
                    return `https://api.vworld.kr/req/data?service=wfs&version=1.0.0&request=GetFeature&typename=${typeName}&outputformat=application/json&srsname=EPSG:4326&bbox=${bbox.join(',')}&apikey=46F4304E-84DC-3F56-92F1-6A98A0370A31&domain=${encodeURIComponent(domain)}`;
                },
                strategy: ol.loadingstrategy.bbox
            });

            return new ol.layer.Vector({
                source: vectorSource,
                style: styleConfig,
                visible: false
            });
        }

        // ì§€ì ë„ê·¼ì  ìŠ¤íƒ€ì¼
        const controlPointStyle = new ol.style.Style({
            image: new ol.style.Circle({
                radius: 4,
                fill: new ol.style.Fill({
                    color: '#ff0000'
                }),
                stroke: new ol.style.Stroke({
                    color: '#ffffff',
                    width: 2
                })
            }),
            text: new ol.style.Text({
                font: '12px Arial',
                fill: new ol.style.Fill({
                    color: '#000000'
                }),
                stroke: new ol.style.Stroke({
                    color: '#ffffff',
                    width: 2
                }),
                offsetY: -15
            })
        });

        // ì—°ì†ì§€ì ë„ ìŠ¤íƒ€ì¼
        const cadastralStyle = new ol.style.Style({
            stroke: new ol.style.Stroke({
                color: '#0066cc',
                width: 1.5
            }),
            fill: new ol.style.Fill({
                color: 'rgba(0, 102, 204, 0.1)'
            })
        });

        // WFS ë ˆì´ì–´ë“¤ ì´ˆê¸°í™”
        function initWFSLayers() {
            // ì§€ì ë„ê·¼ì  ë ˆì´ì–´
            controlPointLayer = createWFSLayer('controlpoint', 'lt_c_uq115', function(feature) {
                const style = controlPointStyle.clone();
                // ë„ê·¼ì  ë²ˆí˜¸ í‘œì‹œ
                const pointNo = feature.get('point_no') || feature.get('cp_no') || '';
                style.getText().setText(pointNo);
                return style;
            });

            // ì—°ì†ì§€ì ë„ ë ˆì´ì–´
            cadastralLayer = createWFSLayer('cadastral', 'lt_c_upis213', cadastralStyle);

            // ë¡œë”© ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            controlPointLayer.getSource().on('loadstart', function() {
                console.log('ì§€ì ë„ê·¼ì  ë°ì´í„° ë¡œë”© ì‹œì‘...');
            });
            
            controlPointLayer.getSource().on('loadend', function() {
                console.log('ì§€ì ë„ê·¼ì  ë°ì´í„° ë¡œë”© ì™„ë£Œ');
            });
            
            controlPointLayer.getSource().on('loaderror', function(event) {
                console.error('ì§€ì ë„ê·¼ì  ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', event);
                alert('ì§€ì ë„ê·¼ì  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\në„ë©”ì¸ ë“±ë¡ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
            });
            
            cadastralLayer.getSource().on('loadstart', function() {
                console.log('ì—°ì†ì§€ì ë„ ë°ì´í„° ë¡œë”© ì‹œì‘...');
            });
            
            cadastralLayer.getSource().on('loadend', function() {
                console.log('ì—°ì†ì§€ì ë„ ë°ì´í„° ë¡œë”© ì™„ë£Œ');
            });
            
            cadastralLayer.getSource().on('loaderror', function(event) {
                console.error('ì—°ì†ì§€ì ë„ ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', event);
                alert('ì—°ì†ì§€ì ë„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.\në„ë©”ì¸ ë“±ë¡ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
            });

            wfsLayers = {
                controlpoint: controlPointLayer,
                cadastral: cadastralLayer
            };
        }

        // ì§€ë„ ì´ˆê¸°í™”
        function initMap() {
            console.log('OpenLayers ì§€ë„ ì´ˆê¸°í™” ì‹œì‘');
            
            // WFS ë ˆì´ì–´ë“¤ ì´ˆê¸°í™”
            initWFSLayers();
            
            // ë§ˆì»¤ìš© ë²¡í„° ì†ŒìŠ¤ì™€ ë ˆì´ì–´
            vectorSource = new ol.source.Vector();
            vectorLayer = new ol.layer.Vector({
                source: vectorSource,
                style: new ol.style.Style({
                    image: new ol.style.Icon({
                        anchor: [0.5, 1],
                        src: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJDOC4xMyAyIDUgNS4xMyA1IDlDNSAxNC4yNSAxMiAyMiAxMiAyMkMxMiAyMiAxOSAxNC4yNSAxOSA5QzE5IDUuMTMgMTUuODcgMiAxMiAyWk0xMiAxMS41QzEwLjYyIDExLjUgOS41IDEwLjM4IDkuNSA5QzkuNSA3LjYyIDEwLjYyIDYuNSAxMiA2LjVDMTMuMzggNi41IDE0LjUgNy42MiAxNC41IDlDMTQuNSAxMC4zOCAxMy4zOCAxMS41IDEyIDExLjVaIiBmaWxsPSIjZTc0YzNjIi8+Cjwvc3ZnPgo=',
                        scale: 1.5
                    })
                })
            });

            // ì§€ë„ ìƒì„±
            map = new ol.Map({
                target: 'map',
                layers: [
                    vworldLayers.Base,  // ê¸°ë³¸ ë ˆì´ì–´
                    cadastralLayer,     // ì—°ì†ì§€ì ë„ ë ˆì´ì–´
                    controlPointLayer,  // ì§€ì ë„ê·¼ì  ë ˆì´ì–´
                    vectorLayer         // ë§ˆì»¤ ë ˆì´ì–´
                ],
                view: new ol.View({
                    center: ol.proj.fromLonLat([126.9780, 37.5665]), // ì„œìš¸ì‹œì²­
                    zoom: 10
                })
            });

            // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸
            map.on('click', function(evt) {
                const coordinate = evt.coordinate;
                const lonLat = ol.proj.toLonLat(coordinate);
                
                updateCoordinateDisplay(lonLat[0], lonLat[1]);
                
                // í´ë¦­ëœ í”¼ì²˜ í™•ì¸
                const features = map.getFeaturesAtPixel(evt.pixel);
                
                if (features.length > 0) {
                    const feature = features[0];
                    const properties = feature.getProperties();
                    
                    // ì§€ì ì •ë³´ íŒì—… í‘œì‹œ
                    showFeatureInfo(properties, lonLat);
                } else {
                    // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
                    vectorSource.clear();
                    
                    // ìƒˆ ë§ˆì»¤ ì¶”ê°€
                    const marker = new ol.Feature({
                        geometry: new ol.geom.Point(coordinate)
                    });
                    
                    vectorSource.addFeature(marker);
                }
            });

            // ì§€ë„ ì´ë™ ì´ë²¤íŠ¸
            map.on('moveend', function() {
                const view = map.getView();
                const center = view.getCenter();
                const lonLat = ol.proj.toLonLat(center);
                const zoom = view.getZoom();
                
                updateCoordinateDisplay(lonLat[0], lonLat[1], Math.round(zoom));
            });

            // ì§€ë„ íƒ€ì… ë³€ê²½ ì´ë²¤íŠ¸
            document.getElementById('mapType').addEventListener('change', function() {
                const selectedType = this.value;
                
                // ê¸°ì¡´ ì§€ë„ ë ˆì´ì–´ ì œê±° (WFS ë ˆì´ì–´ì™€ ë§ˆì»¤ ë ˆì´ì–´ ì œì™¸)
                map.getLayers().forEach(function(layer) {
                    if (layer !== vectorLayer && layer !== cadastralLayer && layer !== controlPointLayer) {
                        map.removeLayer(layer);
                    }
                });
                
                // ìƒˆ ì§€ë„ ë ˆì´ì–´ ì¶”ê°€ (ê°€ì¥ ì•„ë˜ì—)
                map.getLayers().insertAt(0, vworldLayers[selectedType]);
            });

            // ì§€ì ì •ë³´ ë ˆì´ì–´ ë³€ê²½ ì´ë²¤íŠ¸
            document.getElementById('overlayType').addEventListener('change', function() {
                const selectedType = this.value;
                
                // ëª¨ë“  WFS ë ˆì´ì–´ ìˆ¨ê¸°ê¸°
                cadastralLayer.setVisible(false);
                controlPointLayer.setVisible(false);
                
                // ì„ íƒëœ ë ˆì´ì–´ë§Œ í‘œì‹œ
                switch(selectedType) {
                    case 'cadastral':
                        cadastralLayer.setVisible(true);
                        updateActiveLayerDisplay('ê¸°ë³¸ì§€ë„ + ì—°ì†ì§€ì ë„');
                        console.log('ì—°ì†ì§€ì ë„ ë ˆì´ì–´ í™œì„±í™”');
                        break;
                    case 'controlpoint':
                        controlPointLayer.setVisible(true);
                        updateActiveLayerDisplay('ê¸°ë³¸ì§€ë„ + ì§€ì ë„ê·¼ì ');
                        console.log('ì§€ì ë„ê·¼ì  ë ˆì´ì–´ í™œì„±í™”');
                        break;
                    case 'both':
                        cadastralLayer.setVisible(true);
                        controlPointLayer.setVisible(true);
                        updateActiveLayerDisplay('ê¸°ë³¸ì§€ë„ + ì§€ì ì •ë³´');
                        console.log('ëª¨ë“  ì§€ì ì •ë³´ ë ˆì´ì–´ í™œì„±í™”');
                        break;
                    default:
                        updateActiveLayerDisplay('ê¸°ë³¸ì§€ë„');
                        console.log('ì§€ì ì •ë³´ ë ˆì´ì–´ ë¹„í™œì„±í™”');
                }
            });

            // ì´ˆê¸° ì¢Œí‘œ í‘œì‹œ
            updateCoordinateDisplay(126.9780, 37.5665, 10);
            
            console.log('OpenLayers ì§€ë„ ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // ì¢Œí‘œ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateCoordinateDisplay(lng, lat, zoom) {
            document.getElementById('currentLat').textContent = lat.toFixed(6);
            document.getElementById('currentLng').textContent = lng.toFixed(6);
            if (zoom !== undefined) {
                document.getElementById('currentZoom').textContent = zoom;
            }
        }

        // í™œì„± ë ˆì´ì–´ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateActiveLayerDisplay(layerInfo) {
            document.getElementById('activeLayer').textContent = layerInfo;
        }

        // í”¼ì²˜ ì •ë³´ í‘œì‹œ
        function showFeatureInfo(properties, coordinate) {
            let infoContent = '<div style="max-width: 300px;">';
            infoContent += '<h4 style="margin-bottom: 10px; color: #2c3e50;">ğŸ“ ì§€ì ì •ë³´</h4>';
            
            // ì†ì„± ì •ë³´ í‘œì‹œ
            Object.keys(properties).forEach(function(key) {
                if (key !== 'geometry' && properties[key] !== null && properties[key] !== '') {
                    const value = properties[key];
                    const displayKey = getDisplayName(key);
                    infoContent += `<p><strong>${displayKey}:</strong> ${value}</p>`;
                }
            });
            
            infoContent += `<p><strong>ì¢Œí‘œ:</strong> ${coordinate[1].toFixed(6)}, ${coordinate[0].toFixed(6)}</p>`;
            infoContent += '</div>';
            
            // ì•Œë¦¼ìœ¼ë¡œ í‘œì‹œ (ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” íŒì—… ì˜¤ë²„ë ˆì´ ì‚¬ìš© ê¶Œì¥)
            alert(infoContent.replace(/<[^>]*>/g, '\n').replace(/&nbsp;/g, ' '));
        }

        // ì†ì„±ëª…ì„ í•œê¸€ë¡œ ë³€í™˜
        function getDisplayName(key) {
            const nameMap = {
                'point_no': 'ë„ê·¼ì ë²ˆí˜¸',
                'cp_no': 'ë„ê·¼ì ë²ˆí˜¸',
                'instl_de': 'ì„¤ì¹˜ì¼ì',
                'manage_no': 'ê´€ë¦¬ë²ˆí˜¸',
                'pnu': 'í•„ì§€ê³ ìœ ë²ˆí˜¸',
                'jibun': 'ì§€ë²ˆ',
                'bchk': 'ë²•ì •ë™ì½”ë“œ',
                'sgg_oid': 'ì‹œêµ°êµ¬ì½”ë“œ',
                'col_adm_se': 'ê´€í• ì²­êµ¬ë¶„',
                'geometry': 'ê³µê°„ì •ë³´'
            };
            
            return nameMap[key] || key;
        }

        // ìœ„ì¹˜ ê²€ìƒ‰ ë° ì´ë™
        function searchAndMove() {
            const location = document.getElementById('searchLocation').value.trim();
            
            if (!location) {
                alert('ê²€ìƒ‰í•  ìœ„ì¹˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const locations = {
                'ì„œìš¸ì‹œì²­': { lat: 37.5665, lng: 126.9780 },
                'ë¶€ì‚°ì‹œì²­': { lat: 35.1796, lng: 129.0756 },
                'ëŒ€êµ¬ì‹œì²­': { lat: 35.8714, lng: 128.6014 },
                'ì¸ì²œì‹œì²­': { lat: 37.4563, lng: 126.7052 },
                'ê´‘ì£¼ì‹œì²­': { lat: 35.1595, lng: 126.8526 },
                'ëŒ€ì „ì‹œì²­': { lat: 36.3504, lng: 127.3845 },
                'ìš¸ì‚°ì‹œì²­': { lat: 35.5384, lng: 129.3114 },
                'ì„¸ì¢…ì‹œì²­': { lat: 36.4800, lng: 127.2890 },
                'ê²½ê¸°ë„ì²­': { lat: 37.2636, lng: 127.0286 },
                'ê°•ì›ë„ì²­': { lat: 37.8228, lng: 128.1555 },
                'ì¶©ì²­ë¶ë„ì²­': { lat: 36.6424, lng: 127.4890 },
                'ì¶©ì²­ë‚¨ë„ì²­': { lat: 36.5184, lng: 126.8000 },
                'ì „ë¼ë¶ë„ì²­': { lat: 35.7175, lng: 127.1530 },
                'ì „ë¼ë‚¨ë„ì²­': { lat: 34.8679, lng: 126.9910 },
                'ê²½ìƒë¶ë„ì²­': { lat: 36.4919, lng: 128.8889 },
                'ê²½ìƒë‚¨ë„ì²­': { lat: 35.4606, lng: 128.2132 },
                'ì œì£¼ë„ì²­': { lat: 33.4890, lng: 126.4983 }
            };

            const coords = locations[location];
            
            if (coords) {
                moveToLocation(coords.lng, coords.lat);
                document.getElementById('searchLocation').value = '';
            } else {
                alert('í•´ë‹¹ ìœ„ì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì§€ì›ë˜ëŠ” ìœ„ì¹˜:\n' + Object.keys(locations).join(', '));
            }
        }

        // íŠ¹ì • ìœ„ì¹˜ë¡œ ì´ë™
        function moveToLocation(lng, lat, zoom = 15) {
            const coordinate = ol.proj.fromLonLat([lng, lat]);
            
            map.getView().animate({
                center: coordinate,
                zoom: zoom,
                duration: 1000
            });
            
            // ë§ˆì»¤ ì¶”ê°€
            vectorSource.clear();
            const marker = new ol.Feature({
                geometry: new ol.geom.Point(coordinate)
            });
            vectorSource.addFeature(marker);
        }

        // í˜„ì¬ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        moveToLocation(lng, lat);
                        alert(`í˜„ì¬ ìœ„ì¹˜ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤.\nìœ„ë„: ${lat.toFixed(6)}, ê²½ë„: ${lng.toFixed(6)}`);
                    },
                    function(error) {
                        alert('í˜„ì¬ ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
                    }
                );
            } else {
                alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
        }

        // ì´ˆê¸° í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
        function resetView() {
            moveToLocation(126.9780, 37.5665, 10);
            document.getElementById('mapType').value = 'Base';
            
            // ê¸°ë³¸ ì§€ë„ë¡œ ë³€ê²½
            map.getLayers().forEach(function(layer) {
                if (layer !== vectorLayer && layer !== cadastralLayer && layer !== controlPointLayer) {
                    map.removeLayer(layer);
                }
            });
            map.getLayers().insertAt(0, vworldLayers.Base);
            
            // ì§€ì ì •ë³´ ë ˆì´ì–´ ì´ˆê¸°í™”
            document.getElementById('overlayType').value = '';
            cadastralLayer.setVisible(false);
            controlPointLayer.setVisible(false);
        }

        // Enter í‚¤ë¡œ ê²€ìƒ‰
        document.getElementById('searchLocation').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchAndMove();
            }
        });

        // í˜ì´ì§€ ë¡œë“œ í›„ ì§€ë„ ì´ˆê¸°í™”
        window.onload = function() {
            console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ - OpenLayers ì´ˆê¸°í™”');
            try {
                initMap();
            } catch (error) {
                console.error('ì§€ë„ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                document.getElementById('map').innerHTML = 
                    '<div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f8f9fa; color: #666; flex-direction: column; padding: 20px; text-align: center;">' +
                    '<h3 style="color: #e74c3c; margin-bottom: 20px;">ì§€ë„ ë¡œë“œ ì˜¤ë¥˜</h3>' +
                    '<p>ì§€ë„ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>' +
                    '<p>ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>' +
                    '</div>';
            }
        };
    </script>
</body>
</html>
